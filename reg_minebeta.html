<div class="text-box">
  <form id="MineBetaReg">
    <input type="text" name="nickname" placeholder="Ваш нікнейм" style="background-color: #ffffff9f; width: 410px; border-radius: 5px;" required>
    <br>
    <input type="email" name="email" placeholder="Ваш Gmail" style="background-color: #ffffff9f; width: 410px; border-radius: 5px;" required>
    <hr>
    <b>Встановлення скіну</b><br>
    <input type="file" name="skin" accept="image/png" style="width: 410px; cursor: pointer;" required>
    <br><br>

    <!-- Honeypot поле -->
    <input type="text" name="website" style="display:none" autocomplete="off">

    <!-- Turnstile (один) -->
    <div class="cf-turnstile" data-sitekey="SITE_KEY" data-callback="onTurnstile"></div>
    <br>

    <button type="submit" style="background-color: #ffffff9f; border-radius: 10px; cursor: pointer;">Зареєструватися</button>
  </form>
</div>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<script>
let turnstileToken = null;
function onTurnstile(token) {
  turnstileToken = token;
}

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("MineBetaReg");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // honeypot check
    if (form.website.value) {
      alert("Bot detected!");
      return;
    }

    // rate-limit: 1 відправка / 5 хв
    const lastSubmit = localStorage.getItem("lastSubmit");
    if (lastSubmit && (Date.now() - lastSubmit < 5*60*1000)) {
      alert("Зачекайте 5 хв перед наступною відправкою");
      return;
    }

    if (!turnstileToken) {
      alert("Пройдіть CAPTCHA");
      return;
    }

    // --- тут має бути fetch на Worker ---
    const data = {
      nickname: form.nickname.value,
      email: form.email.value,
      token: turnstileToken
    };

    // приклад: поки Worker немає, просто alert
    console.log(data); // для тесту
    alert("Реєстрація успішна (тестова відправка)");

    // зберігаємо час сабміту
    localStorage.setItem("lastSubmit", Date.now());

    // очищаємо форму
    form.reset();
    turnstileToken = null;
  });
});
</script>
