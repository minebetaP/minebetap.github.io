<div class="text-box">
  <form id="MineBetaReg">
    <input type="text" name="nickname" placeholder="Ваш нікнейм" style="background-color: #ffffff9f; width: 410px; border-radius: 5px;" required>
    <br>
    <input type="email" name="email" placeholder="Ваш Gmail" style="background-color: #ffffff9f; width: 410px; border-radius: 5px;" required>
    <hr>
    <b>Встановлення скіну</b><br>
    <input type="file" name="skin" accept="image/png" style="width: 410px; cursor: pointer;" required>
    <br><br>

    <input type="text" name="website" style="display:none" autocomplete="off">
    <script src="https://www.google.com/recaptcha/api.js?render=6LfHujUsAAAAADIb8Y-V8Inb5zdzpKE2pYRpMeAl"></script>
    <br>
    <button type="submit" style="background-color: #ffffff9f; border-radius: 10px; cursor: pointer;">Зареєструватися</button>
  </form>
</div>

<script>
let turnstileToken = null;
function onTurnstile(token) {
  turnstileToken = token;
}

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("MineBetaReg");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // honeypot check
    if (form.website.value) {
      alert("Хоть бот, хоть консольщик, все одно не пропущу, бо прийняв куркотосік :)");
      return;
    }

    // rate-limit: 1 відправка / 5 хв
    const lastSubmit = localStorage.getItem("lastSubmit");
    if (lastSubmit && (Date.now() - lastSubmit < 5*60*1000)) {
      alert("Зачекайте 5 хвилин перед наступною відправкою, бо такі швидкі, що мама не гарюй");
      return;
    }

    if (!turnstileToken) {
      alert("Ви не пройшли CAPTCHA, а за таке, я не дам вам зареєструватися");
      return;
    }

    // --- тут має бути fetch на Worker ---
    const data = {
      nickname: form.nickname.value,
      email: form.email.value,
      token: turnstileToken
    };

    // приклад: поки Worker немає, просто alert
    console.log(data); // для тесту
    alert("test.access.granted.registration = 1");

    // зберігаємо час сабміту
    localStorage.setItem("lastSubmit", Date.now());
    const token = await grecaptcha.execute('SITE_KEY', { action: 'register' });


    // очищаємо форму
    form.reset();
    turnstileToken = null;

    const start = Date.now();

    form.addEventListener("submit", () => {
    const timeSpent = Date.now() - start;
    if (timeSpent < 7000) {
    alert("Поспішиш - людей насмішиш");
    return;

    let humanScore = 0;
    ["mousemove", "keydown", "scroll", "touchstart"].forEach(e =>
    window.addEventListener(e, () => humanScore++)
    );

    if (humanScore < 3) {
    alert("Щось такий підозрілий, не дам зареєструватись >:(");
    return;
    }

  });
});
</script>

